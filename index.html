<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Tennis League</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Work+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B35;
            --secondary: #004E89;
            --accent: #F7B801;
            --team1: #2A9D8F;
            --team2: #E76F51;
            --bg: #0A0E27;
            --surface: #1A1F3A;
            --text: #E8E9F3;
            --text-dim: #9CA3AF;
            --border: #2D3561;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Work Sans', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 107, 53, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 78, 137, 0.1) 0%, transparent 50%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem 0;
        }

        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(2.5rem, 8vw, 4rem);
            letter-spacing: 0.1em;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-dim);
            font-size: clamp(0.8rem, 2vw, 1.1rem);
            text-transform: uppercase;
            letter-spacing: 0.3em;
        }

        .edit-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-family: 'Work Sans', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #ff5722;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
        }

        .edit-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgb(34, 197, 94);
            border-radius: 8px;
            color: rgb(34, 197, 94);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .sync-status {
            font-size: 0.85rem;
            color: var(--text-dim);
            text-align: center;
            margin-top: 0.5rem;
        }

        .tabs {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: var(--surface);
            border: 2px solid var(--border);
            color: var(--text);
            font-family: 'Work Sans', sans-serif;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
        }

        .tab.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .card {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .card-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 0.5rem;
        }

        .fixtures-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .match-card {
            background: linear-gradient(135deg, var(--surface) 0%, rgba(26, 31, 58, 0.6) 100%);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .match-card.completed {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.25) 0%, rgba(42, 157, 143, 0.3) 100%);
            border-color: rgb(34, 197, 94);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
        }

        .match-card.invalid {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.25) 0%, rgba(220, 38, 38, 0.3) 100%);
            border-color: rgb(239, 68, 68);
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }

        .match-card:hover {
            border-color: var(--accent);
            transform: scale(1.02);
        }

        .invalid-badge {
            text-align: center;
            margin-top: 0.75rem;
            font-weight: 700;
            font-size: 0.85rem;
            color: rgb(239, 68, 68);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .round-badge {
            display: inline-block;
            background: var(--secondary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.75rem;
        }

        .match-players {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 0.75rem;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .player-info {
            text-align: left;
        }

        .player-info.away {
            text-align: right;
        }

        .player-name {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .player-team {
            font-size: 0.7rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .vs {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            color: var(--accent);
        }

        .score-inputs {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 0.5rem;
            align-items: center;
        }

        .score-input {
            background: var(--bg);
            border: 2px solid var(--border);
            color: var(--text);
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 700;
            text-align: center;
            font-family: 'Work Sans', sans-serif;
            transition: all 0.3s ease;
            width: 100%;
        }

        .score-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
        }

        .score-input:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .winner-badge {
            text-align: center;
            margin-top: 0.75rem;
            font-weight: 700;
            font-size: 0.85rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--surface);
            border-radius: 8px;
            overflow: hidden;
        }

        thead {
            background: linear-gradient(135deg, var(--secondary) 0%, rgba(0, 78, 137, 0.8) 100%);
        }

        th {
            padding: 0.75rem 0.5rem;
            text-align: left;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            color: white;
        }

        th.center, td.center {
            text-align: center;
        }

        tbody tr {
            border-bottom: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        tbody tr:hover {
            background: rgba(255, 107, 53, 0.1);
        }

        td {
            padding: 0.75rem 0.5rem;
            font-size: 0.85rem;
        }

        .pos {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .player-cell {
            font-weight: 600;
        }

        .team-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }

        .team1 {
            background: rgba(42, 157, 143, 0.2);
            color: var(--team1);
            border: 1px solid var(--team1);
        }

        .team2 {
            background: rgba(231, 111, 81, 0.2);
            color: var(--team2);
            border: 1px solid var(--team2);
        }

        .stat-highlight {
            font-weight: 700;
            color: var(--accent);
        }

        .positive {
            color: var(--team1);
        }

        .negative {
            color: var(--team2);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-dim);
            font-size: 1.2rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--surface);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
        }

        .modal-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .input {
            width: 100%;
            background: var(--bg);
            border: 2px solid var(--border);
            color: var(--text);
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Work Sans', sans-serif;
            margin-bottom: 1rem;
        }

        .input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
        }

        .modal-buttons {
            display: flex;
            gap: 0.75rem;
        }

        .info-text {
            font-size: 0.85rem;
            color: var(--text-dim);
            margin-top: 1rem;
            padding: 0.75rem;
            background: rgba(247, 184, 1, 0.1);
            border-left: 3px solid var(--accent);
            border-radius: 4px;
        }

        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }

            .card {
                padding: 1rem;
            }

            .fixtures-grid {
                grid-template-columns: 1fr;
            }

            th, td {
                padding: 0.5rem 0.25rem;
                font-size: 0.75rem;
            }

            .pos {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>TABLE TENNIS LEAGUE</h1>
            <div class="subtitle">Season 2026</div>
            
            <div class="edit-controls">
                <button id="editBtn" class="btn btn-primary" onclick="showPasswordModal()">
                    üîí Enable Edit Mode
                </button>
                <div id="editStatus" style="display: none;" class="edit-status">
                    ‚úì Edit Mode Active
                    <button class="btn btn-secondary" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;" onclick="disableEditMode()">Lock</button>
                </div>
            </div>
            <div class="sync-status" id="syncStatus">Loading...</div>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="showSection('fixtures')">Fixtures</button>
            <button class="tab" onclick="showSection('individual')">Individual League</button>
            <button class="tab" onclick="showSection('team')">Team League</button>
            <button class="tab" onclick="showSection('rules')">Rules</button>
        </div>

        <!-- Fixtures Section -->
        <div id="fixtures" class="section active">
            <div id="fixturesContent"></div>
        </div>

        <!-- Individual League Section -->
        <div id="individual" class="section">
            <div class="card">
                <div class="card-title">Individual Standings</div>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th class="center">Pos</th>
                                <th>Player</th>
                                <th>Team</th>
                                <th class="center">P</th>
                                <th class="center">W</th>
                                <th class="center">L</th>
                                <th class="center">W-N</th>
                                <th class="center">PF</th>
                                <th class="center">PA</th>
                                <th class="center">Diff</th>
                                <th class="center">Pts</th>
                            </tr>
                        </thead>
                        <tbody id="individual-table"></tbody>
                    </table>
                </div>
                <div class="info-text">
                    <strong>W-N</strong> = Win to Nil (11-0 victories, worth 2 points each)
                </div>
            </div>
        </div>

        <!-- Team League Section -->
        <div id="team" class="section">
            <div class="card">
                <div class="card-title">Team Standings</div>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th class="center">Pos</th>
                                <th>Team</th>
                                <th>Players</th>
                                <th class="center">P</th>
                                <th class="center">W</th>
                                <th class="center">L</th>
                                <th class="center">W-N</th>
                                <th class="center">PF</th>
                                <th class="center">PA</th>
                                <th class="center">Diff</th>
                                <th class="center">Pts</th>
                            </tr>
                        </thead>
                        <tbody id="team-table"></tbody>
                    </table>
                </div>
                <div class="info-text">
                    <strong>Note:</strong> Team points = 1 point per win (even for 11-0 victories)
                </div>
            </div>
        </div>

        <!-- Rules Section -->
        <div id="rules" class="section">
            <div class="card">
                <div class="card-title">League Rules</div>
                
                <h3 style="color: var(--primary); font-size: 1.3rem; margin: 1.5rem 0 1rem 0; font-weight: 700;">Scoring Rules</h3>
                
                <div style="background: rgba(255, 107, 53, 0.1); border-left: 4px solid var(--primary); padding: 1rem; margin-bottom: 1rem; border-radius: 4px;">
                    <div style="margin-bottom: 0.75rem;">
                        <strong style="color: var(--accent);">1)</strong> For games that go past 11 points, the final score will be recorded as <strong>11-10</strong> to the winner.
                    </div>
                    <div style="margin-bottom: 0.75rem;">
                        <strong style="color: var(--accent);">2)</strong> 11-0 victories give the winning player <strong>2 points</strong> on the individual table but only <strong>1 point</strong> on the team table.
                    </div>
                    <div>
                        <strong style="color: var(--accent);">3)</strong> League position will be determined by, in order of priority:
                        <ul style="margin-left: 2rem; margin-top: 0.5rem;">
                            <li><strong>Points</strong> (highest first)</li>
                            <li><strong>Points Difference</strong> (highest first)</li>
                            <li><strong>Points For</strong> (highest first)</li>
                            <li><strong>Wins to Nil</strong> (highest first)</li>
                            <li><strong>Player/Team Name</strong> (alphabetically)</li>
                        </ul>
                    </div>
                </div>

                <h3 style="color: var(--primary); font-size: 1.3rem; margin: 2rem 0 1rem 0; font-weight: 700;">Match Format</h3>
                
                <div style="background: rgba(0, 78, 137, 0.1); border-left: 4px solid var(--secondary); padding: 1rem; margin-bottom: 1rem; border-radius: 4px;">
                    <div style="margin-bottom: 0.75rem;">
                        <strong style="color: var(--accent);">Home vs Away:</strong> The player listed on the <strong>left</strong> is the home player, and the player on the <strong>right</strong> is the away player.
                    </div>
                    <div style="margin-bottom: 0.75rem;">
                        <strong style="color: var(--accent);">Rounds:</strong> The league consists of 4 rounds. Each player plays every other player once per round.
                    </div>
                    <div>
                        <strong style="color: var(--accent);">Home/Away Balance:</strong> Each pair of players will play 4 times total - 2 home games for each player.
                    </div>
                </div>

                <h3 style="color: var(--primary); font-size: 1.3rem; margin: 2rem 0 1rem 0; font-weight: 700;">Abbreviations</h3>
                
                <div style="background: rgba(247, 184, 1, 0.1); border-left: 4px solid var(--accent); padding: 1rem; border-radius: 4px;">
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 0.5rem 1rem; align-items: start;">
                        <strong>P:</strong> <span>Played</span>
                        <strong>W:</strong> <span>Won</span>
                        <strong>L:</strong> <span>Lost</span>
                        <strong>W-N:</strong> <span>Win to Nil (11-0 victories)</span>
                        <strong>PF:</strong> <span>Points For</span>
                        <strong>PA:</strong> <span>Points Against</span>
                        <strong>Diff:</strong> <span>Points Difference (PF - PA)</span>
                        <strong>Pts:</strong> <span>Total Points</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Enter Password</div>
            <input 
                type="password" 
                id="passwordInput" 
                class="input" 
                placeholder="Enter password"
                onkeypress="if(event.key==='Enter') submitPassword()"
            />
            <div class="modal-buttons">
                <button class="btn btn-primary" style="flex: 1;" onclick="submitPassword()">Submit</button>
                <button class="btn btn-secondary" style="flex: 1;" onclick="hidePasswordModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // IMPORTANT: Replace YOUR_BIN_ID with actual bin ID after creating it
        // Visit https://jsonbin.io to create a free account and bin
        const BIN_ID = '69805bcdd0ea881f409a838b';
        const API_KEY = '$2a$10$jMnetQRCB4g0muo8f9o.HuT3pPVCaWwTunQeT9f2OzDrhD0zABr7e';
        const EDIT_PASSWORD = 'cumback';

        const players = {
            'A': { name: 'Phil', team: 'Team 1' },
            'B': { name: 'Adam', team: 'Team 1' },
            'C': { name: 'Alex', team: 'Team 1' },
            'D': { name: 'Martin', team: 'Team 1' },
            'E': { name: 'Maibu', team: 'Team 2' },
            'F': { name: 'Tom', team: 'Team 2' },
            'G': { name: 'Ryan', team: 'Team 2' },
            'H': { name: 'Aaron', team: 'Team 2' }
        };

        const teams = {
            'Team 1': { name: 'Site Services', players: ['A', 'B', 'C', 'D'] },
            'Team 2': { name: 'Machining Maint', players: ['E', 'F', 'G', 'H'] }
        };

        let fixtures = null;
        let isEditMode = false;

        // For demo purposes, use localStorage until BIN_ID is configured
        const USE_LOCAL_STORAGE = BIN_ID === 'YOUR_BIN_ID';

        function generateFixtures() {
            const allMatchups = [];
            const playerCodes = Object.keys(players);
            
            for (let i = 0; i < playerCodes.length; i++) {
                for (let j = i + 1; j < playerCodes.length; j++) {
                    allMatchups.push([playerCodes[i], playerCodes[j]]);
                }
            }

            const newFixtures = { 1: [], 2: [], 3: [], 4: [] };
            
            allMatchups.forEach(([p1, p2]) => {
                const rounds = [1, 2, 3, 4];
                const homeRounds = [];
                while (homeRounds.length < 2) {
                    const r = rounds[Math.floor(Math.random() * rounds.length)];
                    if (!homeRounds.includes(r)) homeRounds.push(r);
                }
                
                [1, 2, 3, 4].forEach(round => {
                    if (homeRounds.includes(round)) {
                        newFixtures[round].push({ home: p1, away: p2, homeScore: null, awayScore: null });
                    } else {
                        newFixtures[round].push({ home: p2, away: p1, homeScore: null, awayScore: null });
                    }
                });
            });

            Object.keys(newFixtures).forEach(round => {
                newFixtures[round].sort(() => Math.random() - 0.5);
            });

            return newFixtures;
        }

        async function loadData() {
            const statusEl = document.getElementById('syncStatus');
            
            if (USE_LOCAL_STORAGE) {
                statusEl.textContent = 'Using local storage (setup JSONBin for cloud sync)';
                const saved = localStorage.getItem('tableTennisFixtures');
                if (saved) {
                    fixtures = JSON.parse(saved);
                } else {
                    fixtures = generateFixtures();
                    localStorage.setItem('tableTennisFixtures', JSON.stringify(fixtures));
                }
                renderAll();
                return;
            }

            statusEl.textContent = 'Syncing with cloud...';
            
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: {
                        'X-Master-Key': API_KEY
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    fixtures = data.record;
                    statusEl.textContent = 'Synced ‚úì';
                } else {
                    throw new Error('Failed to load');
                }
            } catch (error) {
                console.error('Load error:', error);
                fixtures = generateFixtures();
                await saveData();
                statusEl.textContent = 'Created new league';
            }
            
            renderAll();
        }

        async function saveData() {
            if (USE_LOCAL_STORAGE) {
                localStorage.setItem('tableTennisFixtures', JSON.stringify(fixtures));
                return;
            }

            const statusEl = document.getElementById('syncStatus');
            statusEl.textContent = 'Saving...';
            
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': API_KEY
                    },
                    body: JSON.stringify(fixtures)
                });
                
                if (response.ok) {
                    statusEl.textContent = 'Saved ‚úì';
                    setTimeout(() => {
                        statusEl.textContent = 'Synced ‚úì';
                    }, 2000);
                } else {
                    throw new Error('Failed to save');
                }
            } catch (error) {
                console.error('Save error:', error);
                statusEl.textContent = 'Save failed - check connection';
            }
        }

        function showPasswordModal() {
            document.getElementById('passwordModal').classList.add('active');
            document.getElementById('passwordInput').focus();
        }

        function hidePasswordModal() {
            document.getElementById('passwordModal').classList.remove('active');
            document.getElementById('passwordInput').value = '';
        }

        function submitPassword() {
            const password = document.getElementById('passwordInput').value;
            if (password === EDIT_PASSWORD) {
                isEditMode = true;
                document.getElementById('editBtn').style.display = 'none';
                document.getElementById('editStatus').style.display = 'flex';
                hidePasswordModal();
                renderAll();
            } else {
                alert('Incorrect password');
                document.getElementById('passwordInput').value = '';
            }
        }

        function disableEditMode() {
            isEditMode = false;
            document.getElementById('editBtn').style.display = 'inline-block';
            document.getElementById('editStatus').style.display = 'none';
            renderAll();
        }

        async function updateScore(round, index, type, value) {
            if (!isEditMode) {
                alert('Please enable edit mode to make changes');
                return;
            }

            const score = value === '' ? null : parseInt(value);
            if (type === 'home') {
                fixtures[round][index].homeScore = score;
            } else {
                fixtures[round][index].awayScore = score;
            }
            
            await saveData();
            renderAll();
        }

        function getWinner(match) {
            if (match.homeScore === null || match.awayScore === null) return null;
            if (match.homeScore > match.awayScore) return 'home';
            if (match.awayScore > match.homeScore) return 'away';
            return null;
        }

        function isValidScore(homeScore, awayScore) {
            // Both scores must be entered
            if (homeScore === null || awayScore === null) return true; // Not invalid, just incomplete
            
            // At least one score must be 11
            if (homeScore !== 11 && awayScore !== 11) return false;
            
            // The winner must have 11
            if (homeScore === 11 && awayScore >= 11) return false;
            if (awayScore === 11 && homeScore >= 11) return false;
            
            return true;
        }

        function renderFixtures() {
            const container = document.getElementById('fixturesContent');
            container.innerHTML = '';

            [1, 2, 3, 4].forEach(round => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<div class="card-title">Round ${round}</div>`;
                
                const grid = document.createElement('div');
                grid.className = 'fixtures-grid';

                fixtures[round].forEach((match, index) => {
                    const winner = getWinner(match);
                    const valid = isValidScore(match.homeScore, match.awayScore);
                    const hasScores = match.homeScore !== null && match.awayScore !== null;
                    
                    let cardClass = 'match-card';
                    let statusText = '';
                    
                    if (hasScores && !valid) {
                        cardClass = 'match-card invalid';
                        statusText = '<div class="invalid-badge">‚ö†Ô∏è Invalid Score - Winner must have 11</div>';
                    } else if (winner) {
                        cardClass = 'match-card completed';
                        const winnerText = winner === 'home' ? `${players[match.home].name} Wins` : `${players[match.away].name} Wins`;
                        statusText = `<div class="winner-badge">${winnerText}</div>`;
                    }

                    const matchDiv = document.createElement('div');
                    matchDiv.className = cardClass;
                    matchDiv.innerHTML = `
                        <div class="round-badge">Round ${round}</div>
                        <div class="match-players">
                            <div class="player-info">
                                <div style="font-size: 0.7rem; color: var(--accent); font-weight: 700; text-transform: uppercase; margin-bottom: 0.25rem;">HOME</div>
                                <div class="player-name">${players[match.home].name}</div>
                                <div class="player-team">${players[match.home].team}</div>
                            </div>
                            <div class="vs">VS</div>
                            <div class="player-info away">
                                <div style="font-size: 0.7rem; color: var(--text-dim); font-weight: 700; text-transform: uppercase; margin-bottom: 0.25rem;">AWAY</div>
                                <div class="player-name">${players[match.away].name}</div>
                                <div class="player-team">${players[match.away].team}</div>
                            </div>
                        </div>
                        <div class="score-inputs">
                            <input type="number" class="score-input" min="0" max="11" 
                                   value="${match.homeScore !== null ? match.homeScore : ''}" 
                                   onchange="updateScore(${round}, ${index}, 'home', this.value)"
                                   ${!isEditMode ? 'disabled' : ''}>
                            <div>-</div>
                            <input type="number" class="score-input" min="0" max="11" 
                                   value="${match.awayScore !== null ? match.awayScore : ''}" 
                                   onchange="updateScore(${round}, ${index}, 'away', this.value)"
                                   ${!isEditMode ? 'disabled' : ''}>
                        </div>
                        ${statusText}
                    `;
                    
                    grid.appendChild(matchDiv);
                });

                card.appendChild(grid);
                container.appendChild(card);
            });
        }

        function calculateIndividualStats() {
            const stats = {};
            
            Object.keys(players).forEach(code => {
                stats[code] = {
                    code,
                    name: players[code].name,
                    team: players[code].team,
                    played: 0,
                    won: 0,
                    lost: 0,
                    winToNil: 0,
                    pointsFor: 0,
                    pointsAgainst: 0,
                    points: 0
                };
            });

            Object.values(fixtures).flat().forEach(match => {
                // Skip if scores aren't entered or are invalid
                if (match.homeScore === null || match.awayScore === null) return;
                if (!isValidScore(match.homeScore, match.awayScore)) return;
                
                stats[match.home].played++;
                stats[match.away].played++;
                stats[match.home].pointsFor += match.homeScore;
                stats[match.home].pointsAgainst += match.awayScore;
                stats[match.away].pointsFor += match.awayScore;
                stats[match.away].pointsAgainst += match.homeScore;

                if (match.homeScore > match.awayScore) {
                    stats[match.home].won++;
                    stats[match.away].lost++;
                    stats[match.home].points += match.awayScore === 0 ? 2 : 1;
                    if (match.awayScore === 0) stats[match.home].winToNil++;
                } else if (match.awayScore > match.homeScore) {
                    stats[match.away].won++;
                    stats[match.home].lost++;
                    stats[match.away].points += match.homeScore === 0 ? 2 : 1;
                    if (match.homeScore === 0) stats[match.away].winToNil++;
                }
            });

            return Object.values(stats).sort((a, b) => {
                // 1. Sort by Points (highest first)
                if (b.points !== a.points) return b.points - a.points;
                
                // 2. Sort by Points Difference (highest first)
                const aDiff = a.pointsFor - a.pointsAgainst;
                const bDiff = b.pointsFor - b.pointsAgainst;
                if (bDiff !== aDiff) return bDiff - aDiff;
                
                // 3. Sort by Points For (highest first)
                if (b.pointsFor !== a.pointsFor) return b.pointsFor - a.pointsFor;
                
                // 4. Sort by Wins to Nil (highest first)
                if (b.winToNil !== a.winToNil) return b.winToNil - a.winToNil;
                
                // 5. Sort by Name alphabetically
                return a.name.localeCompare(b.name);
            });
        }

        function renderIndividualLeague() {
            const stats = calculateIndividualStats();
            const tbody = document.getElementById('individual-table');
            tbody.innerHTML = '';

            stats.forEach((player, index) => {
                const diff = player.pointsFor - player.pointsAgainst;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="center pos">${index + 1}</td>
                    <td class="player-cell">${player.name}</td>
                    <td><span class="team-badge ${player.team === 'Team 1' ? 'team1' : 'team2'}">${player.team}</span></td>
                    <td class="center">${player.played}</td>
                    <td class="center">${player.won}</td>
                    <td class="center">${player.lost}</td>
                    <td class="center">${player.winToNil}</td>
                    <td class="center">${player.pointsFor}</td>
                    <td class="center">${player.pointsAgainst}</td>
                    <td class="center ${diff > 0 ? 'positive' : diff < 0 ? 'negative' : ''}">${diff > 0 ? '+' : ''}${diff}</td>
                    <td class="center stat-highlight">${player.points}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function calculateTeamStats() {
            const individualStats = calculateIndividualStats();
            const teamStats = {};

            Object.keys(teams).forEach(teamName => {
                const teamPlayers = teams[teamName].players;
                const playerStats = individualStats.filter(p => teamPlayers.includes(p.code));

                teamStats[teamName] = {
                    name: teams[teamName].name,
                    players: teamPlayers.map(code => players[code].name).join(', '),
                    played: playerStats.reduce((sum, p) => sum + p.played, 0),
                    won: playerStats.reduce((sum, p) => sum + p.won, 0),
                    lost: playerStats.reduce((sum, p) => sum + p.lost, 0),
                    winToNil: playerStats.reduce((sum, p) => sum + p.winToNil, 0),
                    pointsFor: playerStats.reduce((sum, p) => sum + p.pointsFor, 0),
                    pointsAgainst: playerStats.reduce((sum, p) => sum + p.pointsAgainst, 0),
                    points: 0
                };
            });

            Object.values(fixtures).flat().forEach(match => {
                // Skip if scores aren't entered or are invalid
                if (match.homeScore === null || match.awayScore === null) return;
                if (!isValidScore(match.homeScore, match.awayScore)) return;
                
                const homeTeam = players[match.home].team;
                const awayTeam = players[match.away].team;

                if (match.homeScore > match.awayScore) {
                    teamStats[homeTeam].points += 1;
                } else if (match.awayScore > match.homeScore) {
                    teamStats[awayTeam].points += 1;
                }
            });

            return Object.values(teamStats).sort((a, b) => {
                // 1. Sort by Points (highest first)
                if (b.points !== a.points) return b.points - a.points;
                
                // 2. Sort by Points Difference (highest first)
                const aDiff = a.pointsFor - a.pointsAgainst;
                const bDiff = b.pointsFor - b.pointsAgainst;
                if (bDiff !== aDiff) return bDiff - aDiff;
                
                // 3. Sort by Points For (highest first)
                if (b.pointsFor !== a.pointsFor) return b.pointsFor - a.pointsFor;
                
                // 4. Sort by Wins to Nil (highest first)
                if (b.winToNil !== a.winToNil) return b.winToNil - a.winToNil;
                
                // 5. Sort by Name alphabetically
                return a.name.localeCompare(b.name);
            });
        }

        function renderTeamLeague() {
            const stats = calculateTeamStats();
            const tbody = document.getElementById('team-table');
            tbody.innerHTML = '';

            stats.forEach((team, index) => {
                const diff = team.pointsFor - team.pointsAgainst;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="center pos">${index + 1}</td>
                    <td class="player-cell">${team.name}</td>
                    <td style="font-size: 0.75rem;">${team.players}</td>
                    <td class="center">${team.played}</td>
                    <td class="center">${team.won}</td>
                    <td class="center">${team.lost}</td>
                    <td class="center">${team.winToNil}</td>
                    <td class="center">${team.pointsFor}</td>
                    <td class="center">${team.pointsAgainst}</td>
                    <td class="center ${diff > 0 ? 'positive' : diff < 0 ? 'negative' : ''}">${diff > 0 ? '+' : ''}${diff}</td>
                    <td class="center stat-highlight">${team.points}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderAll() {
            renderFixtures();
            renderIndividualLeague();
            renderTeamLeague();
        }

        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(section).classList.add('active');
            event.target.classList.add('active');
        }

        loadData();
    </script>
</body>
</html>